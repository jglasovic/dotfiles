let g:plugged_dir_path = expand('$HOME/.vim/plugged')
let g:autoload_plug_path = expand('$HOME/.vim/autoload/plug.vim')

" load plugins
if empty(glob(g:autoload_plug_path))
  silent exec "!curl -fLo ".g:autoload_plug_path." --create-dirs "
    \ ."https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim"
endif

" check for plugged dir
if empty(glob(g:plugged_dir_path))
  silent exec "!mkdir ".g:plugged_dir_path
  autocmd VimEnter * PlugInstall --sync | source $MYVIMRC
endif

" run PlugInstall if there are missing plugins
autocmd VimEnter * if len(filter(values(g:plugs), '!isdirectory(v:val.dir)'))
  \| PlugInstall --sync | source $MYVIMRC
\| endif


call plug#begin(g:plugged_dir_path)
  " colorscheme
  Plug 'joshdick/onedark.vim'
  " tmux navigation
  Plug 'christoomey/vim-tmux-navigator'
  " fuzzy finder
  Plug 'junegunn/fzf', {'do': {-> fzf#install()}}
  Plug 'junegunn/fzf.vim'
  " git
  Plug 'tpope/vim-fugitive'
  " github url yank
  Plug 'pgr0ss/vim-github-url'
  " text support
  Plug 'tpope/vim-surround'
  Plug 'tpope/vim-commentary'
  " db client
  Plug 'tpope/vim-dadbod'
  Plug 'kristijanhusak/vim-dadbod-ui', {'do': 'git am ../../jump-to-fk-fix.patch'}
  " RestAPI client
  Plug 'diepm/vim-rest-console'
  " code testing
  Plug 'vim-test/vim-test'
  " tmux control 
  Plug 'preservim/vimux'

  if has('python3')
    " python virtualenvs support
    Plug 'petobens/poet-v'
  endif
  
  if has('nvim')
    " async support
    Plug 'nvim-lua/plenary.nvim'
    " package manager
    Plug 'williamboman/mason.nvim', { 'do': ':MasonUpdate' }
    " lsp
    Plug 'williamboman/mason-lspconfig.nvim'
    Plug 'neovim/nvim-lspconfig'
    " completion
    Plug 'echasnovski/mini.completion'
    Plug 'kristijanhusak/vim-dadbod-completion'
    " formatter/linter
    Plug 'jose-elias-alvarez/null-ls.nvim'
    " dap
    Plug 'mfussenegger/nvim-dap'
    " treesitter
    Plug 'nvim-treesitter/nvim-treesitter', {'do': ':TSUpdate'}
  endif

call plug#end()


" vim configs
runtime! rcfiles/*.vim
" plugin configs
runtime! rcplugins/*.vim

if has('nvim')
  runtime! rcplugins/*.lua
endif
