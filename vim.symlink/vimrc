let g:plugged_dir_path = '~/.vim/plugged'
let g:autoload_plug_path = '~/.vim/autoload/plug.vim'

" load plugins
if empty(glob(g:autoload_plug_path))
  silent exec "!curl -fLo ".g:autoload_plug_path." --create-dirs "
    \ ."https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim"
endif

" check for plugged dir
if empty(glob(g:plugged_dir_path))
  silent exec "!mkdir ".g:plugged_dir_path
  autocmd VimEnter * PlugInstall --sync | source $MYVIMRC
endif

" run PlugInstall if there are missing plugins
autocmd VimEnter * if len(filter(values(g:plugs), '!isdirectory(v:val.dir)'))
  \| PlugInstall --sync | source $MYVIMRC
\| endif


call plug#begin(g:plugged_dir_path)
  Plug 'christoomey/vim-tmux-navigator'
  Plug 'junegunn/fzf', {'do': {-> fzf#install()}}
  Plug 'junegunn/fzf.vim'

  if has('nvim')
    Plug 'nvim-lua/plenary.nvim'
    Plug 'lewis6991/gitsigns.nvim'
    Plug 'nvim-treesitter/nvim-treesitter', {'do': ':TSUpdate'}
    Plug 'petobens/poet-v'
    Plug 'puremourning/vimspector'
  endif

  if has('nvim') && $USE_LSP == 'true'
    Plug 'neovim/nvim-lspconfig'
    Plug 'hrsh7th/nvim-cmp'
    Plug 'hrsh7th/cmp-nvim-lsp'
    Plug 'saadparwaiz1/cmp_luasnip'
    Plug 'L3MON4D3/LuaSnip'
    Plug 'jose-elias-alvarez/null-ls.nvim'
  else
      Plug 'neoclide/coc.nvim', {'branch': 'release'}
  endif

  Plug 'tpope/vim-fugitive'
  Plug 'tpope/vim-surround'
  Plug 'tpope/vim-commentary'
  Plug 'tpope/vim-dadbod'
  Plug 'kristijanhusak/vim-dadbod-ui'
  Plug 'tsandall/vim-rego'
  Plug 'pgr0ss/vim-github-url'
  Plug 'joshdick/onedark.vim'
call plug#end()


" vim configs
runtime! rcfiles/*.vim

" plugin configs
runtime! rcplugins/*.vim
if has('nvim')
  runtime! rcplugins/*.lua
endif
